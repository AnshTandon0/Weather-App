(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{"1obm":function(e,t,o){"use strict";o.r(t),o.d(t,"FetchDocumentPageModule",(function(){return b}));var n=o("mrSG"),i=o("fXoL"),r=o("ofXK"),a=o("3Pt+"),s=o("TEn/"),c=o("tyNb"),l=o("sRcL"),d=o("9ans"),h=o("AytR"),m=o("NFKh"),u=o("jhN1");let f=class{constructor(e,t,o,n,i,r,s){var c;this.formBuilder=e,this.ajax=t,this.auth=o,this.navCtrl=n,this.router=i,this.titleService=r,this.platform=s,this.deviceSize=this.platform.isLandscape(),this.isSubmitted=!1,this.otp=!1,this.respMsg=null,this.fetchDocFormData=null,this.docData=null===(c=this.router.getCurrentNavigation())||void 0===c?void 0:c.extras.state,this.validationArray={consent:[!0,a.f.required]},this.profile=null,this.deviceId=this.auth.getDeviceId(),this.jtoken=this.auth.getToken(),this.maxTime=0}ngOnInit(){this.fetchDocForm=this.formBuilder.group(this.validationArray),this.profile=this.auth.userProfile(),null!=this.docData?this.fetchDocFormDataApi():(this.docData=JSON.parse(sessionStorage.getItem("fetchDoc")),this.docData&&!["ADHAR"].includes(this.docData.docTypeId)?this.fetchDocFormDataApi():this.navCtrl.pop())}ionViewDidEnter(){this.titleService.setTitle("Fetch Document")}fetchDocFormDataApi(){this.docData.parameters.iparams.forEach(e=>{this.validationArray[e.keyname]=["",[a.f.required]]}),this.fetchDocForm=this.formBuilder.group(this.validationArray),"1"==this.docData.parameters.details.enabledDob||"1"==this.docData.parameters.details.enabledGender?this.ajax.postMethod(h.a.profile,"",{}).subscribe(e=>{e.customDob=e.date_of_birth?e.date_of_birth.slice(0,10):null,this.fetchDocFormData=e}):this.fetchDocFormData=[]}submitForm(){if(this.isSubmitted=!0,this.respMsg=null,!this.fetchDocForm.valid)return!1;{this.ajax.showLoader();let e=this.fetchDocRequestParam();this.ajax.postMethod(h.a.fetchDocRequest,JSON.stringify({data:e}),{"content-type":"application/json"}).subscribe(e=>{this.ajax.hideLoader(),null!=e.request_id?(this.ajax.showToast("Your request has been submitted. Please wait for confirmation from the Issuer.",3e3,"warning","bottom"),this.chekTxnStatus(e.request_id,1)):this.ajax.showToast(e.error_description,3e3,"warning","bottom")})}}chekTxnStatus(e,t=2){this.maxTime<=30?(1==t&&this.ajax.showLoader(),setTimeout(o=>{this.maxTime=this.maxTime+5;let n={jtoken:this.jtoken,"device-security-id":this.deviceId};this.ajax.getMethod(h.a.fetchDocRequest+"?request_id="+e,n).subscribe(o=>{1==t&&this.ajax.hideLoader(),null!=o.status&&(["S","F"].includes(o.status)?(this.ajax.showToast("S"==o.status?"Document fetched successfully.":o.remarks,3e3,"S"==o.status?"success":"warning","bottom"),"S"==o.status&&this.navCtrl.navigateForward("issued-documents")):(this.chekTxnStatus(e),this.ajax.showToast(o.remarks,5e3,"warning","bottom")))})},5e3)):this.ajax.hideLoader()}issuedDocPendingData(e){return{doc_type_id:this.docData.docTypeId,org_id:this.docData.orgId,uri:"Pending-"+this.docData.docTypeId+"-Pending",issuer_id:"Pending",modified_on:(new Date).toLocaleDateString("en-CA"),categories:[],orgName:this.docData.orgName,docDescription:this.docData.docDescription,issuedOn:(new Date).toLocaleDateString("en-CA"),repoId:this.docData.partnerServiceId,metadata:"",data_type_xml:"",data_type_pdf:"",date:(new Date).toLocaleDateString("en-CA"),dataType:{xml:0,json:0,pdf:0},delete:0,txn_id:e}}fetchDocRequestParam(){let e=Object(m.MD5)(this.auth.userProfile().residentName.replace(/\s+/g,"").toLowerCase()).toString(),t="WSTL"+Date.now()+e,o={doc_type:this.docData.docTypeId,org_id:this.docData.orgId,record_from:"WSTL",txn_id:t,consent:this.fetchDocForm.value.consent?"true":"false"};return this.docData.parameters.iparams&&this.docData.parameters.iparams.forEach(e=>{o[e.keyname]=this.fetchDocForm.value[e.keyname]}),o}get errorControl(){return this.fetchDocForm.controls}onTermsChecked(){this.fetchDocForm.value.consent||this.fetchDocForm.patchValue({consent:null})}dismiss(){sessionStorage.removeItem("fetchDoc"),this.navCtrl.pop()}};f.ctorParameters=()=>[{type:a.a},{type:l.a},{type:d.a},{type:s.i},{type:c.g},{type:u.d},{type:s.k}],f=Object(n.c)([Object(i.n)({selector:"app-fetch-document",template:Object(n.f)(o("bkRp")).default,styles:[Object(n.f)(o("4POB")).default]})],f);const p=[{path:"",component:f}];let D=class{};D=Object(n.c)([Object(i.M)({imports:[c.i.forChild(p)],exports:[c.i]})],D);let b=class{};b=Object(n.c)([Object(i.M)({imports:[r.b,a.b,a.e,s.d,D],declarations:[f]})],b)},"4POB":function(e,t,o){"use strict";o.r(t),t.default=".item.sc-ion-label-ios-h, .item .sc-ion-label-ios-h {\n  white-space: unset;\n}"},bkRp:function(e,t,o){"use strict";o.r(t),t.default='<ion-header>\r\n    <ion-toolbar>\r\n        <ion-buttons slot="start">\r\n            <ion-menu-button></ion-menu-button>\r\n        </ion-buttons>\r\n        <ion-title></ion-title>\r\n    </ion-toolbar>\r\n</ion-header>\r\n<ion-content class="ion-padding">\r\n\r\n    <ion-grid [fixed]="true">\r\n        <ion-toolbar>\r\n            <ion-title color="tertiary">\r\n                <strong>{{docData.docDescription}}</strong>\r\n            </ion-title>\r\n            <ion-buttons slot="start">\r\n                <ion-button (click)="dismiss()" color="dark" fill="clear" shape="round" size="small">\r\n                    <ion-icon ios="arrow-back" md="arrow-back"></ion-icon>\r\n                </ion-button>\r\n            </ion-buttons>\r\n        </ion-toolbar>\r\n    </ion-grid>\r\n    <ion-grid [fixed]="true">\r\n\r\n        <ion-row *ngIf="this.docData.parameters.iparams">\r\n            <ion-col size-md="8">\r\n                <ion-card mode="ios" class="ion-padding ion-no-margin">\r\n                    <ion-row>\r\n                        <ion-col class="ion-padding">\r\n                            <ion-text color="tertiary" class="ion-no-margin ion-padding-start">\r\n                                <h3><strong> Get your document by entering the required details </strong>\r\n                                </h3>\r\n                            </ion-text>\r\n                        </ion-col>\r\n                    </ion-row>\r\n                    <form [formGroup]="fetchDocForm" (ngSubmit)="submitForm()" novalidate>\r\n                        <ion-row *ngIf="docData.parameters.details.enabledFullname==\'1\'">\r\n                            <ion-col size-md="4" size="12">\r\n                                <ion-item lines="none">\r\n                                    <ion-label> Name</ion-label>\r\n                                </ion-item>\r\n                            </ion-col>\r\n                            <ion-col size-md="8" size="12">\r\n                                <ion-item lines="full">\r\n                                    <ion-label>\r\n                                        {{profile.residentName}}\r\n                                    </ion-label>\r\n\r\n                                </ion-item>\r\n                            </ion-col>\r\n                        </ion-row>\r\n                        <ion-row *ngIf="docData.parameters.details.enabledDob==\'1\'">\r\n                            <ion-col size-md="4" size="12">\r\n                                <ion-item lines="none">\r\n                                    <ion-label>Date of Birth</ion-label>\r\n\r\n                                </ion-item>\r\n                            </ion-col>\r\n                            <ion-col size-md="8" size="12">\r\n                                <ion-item lines="full">\r\n                                    <ion-label *ngIf="fetchDocFormData">\r\n                                        {{(fetchDocFormData.customDob)?(fetchDocFormData.customDob | date : \'dd-MM-yyyy\':\'IST\'):\'\'}}\r\n                                    </ion-label>\r\n                                    <ion-skeleton-text *ngIf="!fetchDocFormData" animated style="width: 100%;height:25px;"></ion-skeleton-text>\r\n                                </ion-item>\r\n                            </ion-col>\r\n                        </ion-row>\r\n                        <ion-row *ngIf="docData.parameters.details.enabledGender==\'1\'">\r\n                            <ion-col size-md="4" size="12">\r\n                                <ion-item lines="none">\r\n                                    <ion-label> Gender</ion-label>\r\n                                </ion-item>\r\n                            </ion-col>\r\n                            <ion-col size-md="8" size="12">\r\n                                <ion-item lines="full">\r\n                                    <ion-label *ngIf="fetchDocFormData">\r\n                                        {{(fetchDocFormData.gender==\'M\')?\'Male\':(fetchDocFormData.gender==\'F\')?\'Female\':(fetchDocFormData.gender==\'O\')?\'Other\':\'\'}}\r\n                                    </ion-label>\r\n                                    <ion-skeleton-text *ngIf="!fetchDocFormData" animated style="width: 100%;height:25px;"></ion-skeleton-text>\r\n                                </ion-item>\r\n                            </ion-col>\r\n                        </ion-row>\r\n                        <ion-row *ngFor="let fd of docData.parameters.iparams">\r\n                            <ion-col size-md="4" size="12">\r\n                                <ion-item lines="none">\r\n                                    <ion-label>{{fd.label}}</ion-label>\r\n                                </ion-item>\r\n                            </ion-col>\r\n                            <ion-col size-md="8" size="12">\r\n                                <ion-item lines="full" mode="md">\r\n                                    <ion-input *ngIf="!fd.dd_value" [attr.disabled]="(fetchDocFormData?false:true)" placeholder="Example: {{fd.example}}" formControlName="{{fd.keyname}}" type="text" required></ion-input>\r\n                                    <ion-select *ngIf="fd.dd_value" value="{{fd.keyname}}" formControlName="{{fd.keyname}}" mode="md" interface="popover" placeholder="Select {{fd.label}}" required>\r\n                                        <ion-select-option *ngFor="let op of fd.dd_value.split(\',\')">{{op}}</ion-select-option>\r\n                                    </ion-select>\r\n                                </ion-item>\r\n                                <ion-label color="danger" *ngIf="isSubmitted && errorControl[fd.keyname].errors?.required">\r\n                                    <br />\r\n                                    <small> {{fd.label}} is required.</small>\r\n                                </ion-label>\r\n                            </ion-col>\r\n                        </ion-row>\r\n                        <ion-row>\r\n                            <ion-col>\r\n                                <ion-list>\r\n                                    <ion-item lines="none" mode="md">\r\n                                        <ion-text>I provide my consent to DigiLocker to share my details with the Issuers for the purpose of fetching my documents.</ion-text>\r\n                                        <ion-checkbox [attr.disabled]="(fetchDocFormData?false:true)" slot="start" [checked]="false" formControlName="consent" (ionChange)="onTermsChecked()" required></ion-checkbox>\r\n\r\n                                    </ion-item>\r\n                                </ion-list>\r\n                                <ion-text class="ion-padding-start" color="danger" *ngIf="isSubmitted && errorControl.consent.errors?.required">\r\n                                    <br /> Please give your consent.\r\n                                </ion-text>\r\n                            </ion-col>\r\n                        </ion-row>\r\n\r\n                        <ion-button [attr.disabled]="(fetchDocFormData?false:true)" type="submit" color="primary" class="ion-float-right">Get document</ion-button>\r\n                    </form>\r\n                </ion-card>\r\n            </ion-col>\r\n            <ion-col size-md="4" class="ion-no-padding" *ngIf="deviceSize">\r\n                <ion-card mode="ios" color="warning" class="ion-no-margin-top" *ngIf="docData.orgDescription">\r\n                    <ion-card-content>\r\n                        <ion-text>{{docData.orgDescription}}</ion-text>\r\n                    </ion-card-content>\r\n                </ion-card>\r\n            </ion-col>\r\n        </ion-row>\r\n    </ion-grid>\r\n\r\n</ion-content>'}}]);